/*
 * main.c
 *
 * Created: 8/23/2022 5:23:29 PM
 *  Author: Olifa
 */

//**************************************************************************************
//DEFINICIONES
//************************************************************************************** 
#define F_CPU 8000000UL

//**************************************************************************************
//INCLUDES
//**************************************************************************************
#include <xc.h>
#include <avr/io.h>
#include <util/delay.h>
#include <avr/interrupt.h>
#include "SPIATMcom.h"

//**************************************************************************************
//VARIABLES
//**************************************************************************************

uint8_t rData = 0;
uint8_t tData = 0;

//**************************************************************************************
//PROTOTIPOS
//**************************************************************************************

void IO_set(void);

//**************************************************************************************
//PROGRAMA
//**************************************************************************************

int main(void)
{
	IO_set();
	SPIATM_set(0,LeastFirst,0,Master,_F128);
	_delay_ms(10);
	while (1)
	{
		SPIATM_SSstart(C,4);
		SPIATM_Tx(tData);
		rData = SPDR;
		SPIATM_SSstop(C,4);
		PORTD = rData;
	}
	
}

void IO_set(void)
{
	DDRC  = 0x00;	//Establecemos C como entradas (sin usar)
	PORTC = 0xFF;	//Activamos los pull-up
	DDRC  |= (1<<PINC4);	//Establecemos el pin C4 como Esclavo 1
	PORTC |= (1<<PINC4);	//Apagamos la comunicacion con Esclavo 1
	DDRD  = 0xFF;	//Establecemos D como salidas (Leds)
}

//**************************************************************************************
//INTERRUPCIONES
//**************************************************************************************

